%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Rayleigh-B\'enard}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Physics}

We consider the resolution of the 2D Navier-Stokes equations coupled to the heat equation in a cavity of length $L$ and height $H$, with a hot bottom plate and cold top plate. Under certain circonstances, this setup is known to lead to the Rayleigh-B\'enard convection cell, which is illustrated in figure \ref{fig:rayleigh_convection}. The resulting system is driven by the following set of equations:

\begin{equation}
\label{eq:rayleigh}
\begin{split}
	\nabla \cdot \V{u} 						&= 0, \\
	\partial_t \V{u} + (\V{u} \cdot \nabla) \, \V{u} 	&= -\nabla p + \sqrt{\frac{\pr}{\ra}} \nabla^2 \V{u} + \theta \V{\hat{y}}, \\
	\partial_t \theta + (\V{u} \cdot \nabla) \, \theta 	&= \frac{1}{\sqrt{\pr \, \ra}} \nabla^2 \theta,
\end{split}
\end{equation}

where $\V{u}$, $p$ and $\theta$ are respectively the non-dimensional velocity, pressure, and temperature  of the fluid. The adimensional temperature $\theta$ is described in terms of the hot and cold reference temperatures, respectively denoted as $T_H$ and $T_C$: 

\begin{equation*}
	\theta = \frac{T - \hat{T}}{\Delta T}, \text{with } \hat{T} = \frac{T_H + T_C}{2} \text{ and } \Delta T = T_H - T_C.
\end{equation*}

The dynamics of the system (\ref{eq:rayleigh}) are controlled by two adimensional numbers. First, the Prandtl number $\pr$, which represents the ratio of the momentum diffusivity over the thermal diffusivity: 

\begin{equation*}
	\pr = \frac{\nu}{\kappa},
\end{equation*}

where $\nu$ is the kinematic viscosity and $\kappa$ the thermal diffusivity. Second, the Rayleigh number $\ra$, which compares the characteristic time scales for transport due to diffusion and convection:

\begin{equation*}
	\ra = \frac{g \alpha \Delta T H^3}{\kappa \nu},
\end{equation*}

with $g$ the magnitude of the acceleration of the gravity and $\alpha$ the thermal expansion coefficient. We also define the instantaneous Nusselt number, $\nus$, as the adimensionalized heat flux averaged over the hot wall:

\begin{equation}
\label{eq:nusselt}
	\nus (t) = - \int_{0}^{L} \partial_y \theta (x',y=0,t) dx'.
\end{equation}

The system (\ref{eq:rayleigh}) is completed by the following initial and boundary conditions:

\begin{equation}
\label{eq:rayleigh_bc}
\begin{split}
	\V{u}(x,y,0)	= 0 &\text{ and } \theta(x,y,0)	= 0, \\
	\V{u}(x=0,y,t)	= 0 &\text{ and } \V{u}(x=L,y,t) = 0, \\
	\V{u}(x,y=0,t)	= 0 &\text{ and } \V{u}(x,y=H,t) = 0, \\
	\theta(x,y=0,t) 	= \theta_H &\text{ and } \theta(x,y=H,t) = \theta_C, \\
	\partial_x \theta(x=0,y,t) = 0 &\text{ and } \partial_x \theta(x=L,y,t) = 0,
\end{split}
\end{equation}

In essence, the boundary conditions (\ref{eq:rayleigh_bc}) correspond to (i) a no-slip boundary conditions for the fluid on all boundaries, (ii) imposed hot and cold temperatures respectively on the bottom and top plate, and (iii) adiabatic boundary conditions on the lateral sides of the domain. Here, we choose $\theta_H = \frac{1}{2}$ and $\theta_C = -\frac{1}{2}$. A sketch of the configuration is presented in figure \ref{fig:rayleigh_sketch}.

\input{fig/rayleigh/sketch}

Above a critical value $\ra_c$, natural convection is triggered in the cell, increasing the heat exchange between the bottom and top regions of the cell, thus leading to $\nus > 1$. Illustrations of the temperature and velocity fields are proposed in figure \ref{fig:rayleigh_convection}.

\input{fig/rayleigh/convection}
%
%The situation is summed up in figure \ref{fig:sloshing_tank}. When excited laterally, the surface of the fluid sloshes back and forth in the tank generating complex patterns at the fluid surface, as shown in figure \ref{fig:sloshing_examples}. When the excitation stops, a relaxation phase is observed, usually leaving a single wavefront travelling back and forth in the tank until it dissipates entirely. Due to its simplicity, the model (\ref{eq:stvenant}) does not allow wave breaking nor the formation of drops on the sides of the domain.
%
%\input{fig/sloshing/tank}
%
%\input{fig/sloshing/sloshing_free}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Discretization}

The system (\ref{eq:rayleigh}) is discretized using a structured finite volume incremental projection scheme with centered fluxes, in the fashion of \cite{boivin2000}. For simplicity, the scheme is solved in a fully explicit way, except for the resolution of the Poisson equation for pressure. As is standard, a staggered grid is used for the finite volume scheme: the horizontal velocity is located on the west face of the cells, the vertical velocity is on the south face of the cells, while the pressure and temperature are located at the center of the cells. The computation of the instantaneous Nusselt number (\ref{eq:nusselt}) is performed by computing the first-order finite difference of the temperature between the center of the first cell at the bottom of the mesh and the reference temperature $T_H$. Doing so, we obtain $\nus = 2.16$  for $\ra = \num{1e4}$ once the permanent regime is reached, which is close to the reference values found in the literature, that range between $2.20$ and $2.24$ \cite{markatos1984}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Environment}

The proposed environment is re-implemented based on the original publication of Beintema \textit{et al.} \cite{beintema2020}. In the following, we set $\pr=0.71$, which corresponds to the parameter for air, and $\ra = \num{1e4}$ in order to avoid high computational load. Similarly to \cite{beintema2020}, the control is performed by letting the DRL agent adjust the temperature of $n_s=10$ individual segments at the bottom of the cavity, the average temperature of the bottom plate being enforced to remain equal to $\theta_H$ (see figure \ref{fig:rayleigh_sketch_env}). To do so, the actions proposed by the agent are continuous temperature fluctuations $\left\{ \hat{\theta}_i \right\}_{i \in \llbracket 0, n_s-1 \rrbracket}$ in the range $\left[-C, +C\right]$, with $C=0.75$. To enforce $\left< \theta(y=0,x,t) \right> = \theta_H$, the provided $\hat{\theta}_i$ are normalized into the zero-average control $\theta_i$ as:

\begin{equation}
	\theta_i = \hat{\theta}_i - \left< \hat{\theta}_i \right>.
\end{equation}

For simplicity, no interpolation is performed between actions, neither spatially nor temporally. The spatial discretization step is set as $\Delta x = 0.02$, while the numerical time step is $\Delta t = 0.01$. The action time-step $\Delta t_\text{act}$ is equal to $1$ time unit, with the total episode length being fixed to $200$ time units, corresponding to $200$ actions.

\input{fig/rayleigh/sketch_env}

The observations provided to the agent are the temperatures collected on a grid of $n_p \times n_p$ probes evenly spaced in the computational domain (see figure \ref{fig:rayleigh_sketch_env}), along with the observations of the previous $n_h = 3$ time-steps. Contrarily to \cite{beintema2020}, the velocities are not provided to the agent. The resulting set of observations is flattened in a vector of size $(n_h+1) \times n_p^2$.

The reward at each times-step is simply set as the negative instantaneous Nusselt number, such that increasing the reward corresponds to a decrease of the temperature convection:

\begin{equation}
	r(t) = - \nus (t).
\end{equation}

%
%The control of the system (\ref{eq:stvenant}) is performed through the cart acceleration term $\ddot{y}$. The system is first set in motion during $t_\text{exc} = 2$ time units using a sinusoid-based signal:
%
%\begin{equation}
%	\ddot{y}_\text{exc} (t) = \frac{1}{2} \left( \cos ( \pi t ) + 3 \cos ( 4 \pi t) \right).
%\end{equation}
%
%The resulting fields are stored on file for simplicity, and loaded at the beginning of each episode. By default, the length of the cart is $L = 2.5$, the spatial discretization corresponds to $100$ finite volume cells per unit of length, and the numerical time step is $\Delta t = 0.001$ time units. The actions provided to the environment, which are expected to be in $\left[-1, 1\right]$, are then scale by an \textit{ad-hoc} non-dimensional amplitude factor $A=2$. The interpolation between successive actions is identical to (\ref{eq:shkadov_actions}), with $\Delta t_\text{int} = 0.01$ time units and $\Delta t_\text{act} = 0.05$ time units. The total episode time is fixed to $10$ time units, corresponding to $200$ actions. The observations provided to the agent are the heights collected on the entire domain. To limit the size of the resulting vector, it is downsampled by a factor 2. Finally, the reward signal is defined as:
%
%\begin{equation}
%\label{eq:sloshing_reward}
%	r(t) = - \Delta x \norm{h(x,t) - 1}_2 - \alpha \left| \ddot{y} (t) \right|,
%\end{equation}
%
%where $\norm{\cdot}_2$ is the $2$-norm and $\alpha = 0.0005$. The $\Delta x$ factor allows to obtain comparable reward values for variable discretization levels.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Results}

The environment as described in the previous section is referred to as \codeinline{rayleigh-v0}, and its default parameters are provided in table \ref{table:rayleigh_parameters}.
%The environment as described in the previous section is referred to as \codeinline{rayleigh-v0}, in the fashion of the \textsc{gym} environments (the default parameters of the environment are provided in table \ref{table:sloshing_parameters}). In this section, we provide some results related to its resolution using a \textsc{ppo} agent (see the general hyperparameters in table \ref{table:default_ppo_parameters}). For the training, we set $n_\text{rollout} = 2000$, $n_\text{batch} = 2$, $n_\text{epoch} = 16$ and $n_\text{max} = 200k$.
%
%The score curve obtained with the PPO algorithm is presented in \ref{fig:sloshing_score}, while the time evolutions of the controlled versus uncontrolled fluid level are shown in figure \ref{fig:sloshing_fields}. As can be observed, the agent manages to roughly cut the uncontrolled reward in half, by suppressing the back and forth wavefront using large actuations in the early stages of control, after what the control amplitude drops significantly.

%%%%%%%%%%%%
%%%%%%%%%%%%
\begin{table}
    \footnotesize
    \caption{\textbf{Default parameters used for the \codeinline{rayleigh-v0} environment.}}
    \label{table:rayleigh_parameters}
    \centering
    \begin{tabular}{rll}
        \toprule
        \codeinline{L}			& length of the domain					& $1$\\
	\codeinline{H}			& height of the domain					& $1$\\
	\codeinline{n_sgts}		& number of control segments				& $10$\\
	\codeinline{ra}			& Rayleigh number						& $\num{1e4}$\\
        \bottomrule
    \end{tabular}
\end{table}
%%%%%%%%%%%%
%%%%%%%%%%%%
%%
%\input{fig/sloshing/score}
%%
%\input{fig/sloshing/fields}
